# Movie Recommendation System

This project implements a scalable movie recommendation system using PostgreSQL for data storage and Keras for model training. The goal is to simulate a production-ready architecture for collaborative filtering, incorporating a clean ETL pipeline and future automation with Apache Airflow.

## Overview

The system is designed as an end-to-end ETL pipeline for generating movie recommendations. It extracts raw rating data, transforms it into a feature-rich training set, trains a neural collaborative filtering model, and stores both transformed inputs and model predictions in dedicated database schemas.

The architecture separates data into clear layers:

- **`raw.ratings`** – Full dataset (32M records) simulating an external data source.
- **`data_lake.ratings`** – 2M randomly sampled records used for training the model.
- **`data_storage.ratings`** – Contains cleaned and feature-engineered data ready for inference.
- **`predictions.ratings`** – Stores final predicted ratings generated by the model.

This separation ensures traceability, modularity, and makes the pipeline easy to automate and scale.

## Technologies Used

- **Python**
- **PostgreSQL** with schemas (`raw`, `data_lake`, `data_storage`, `predictions`)
- **Polars** – fast and efficient data transformation engine
- **SQLAlchemy** – for database connectivity
- **TensorFlow / Keras** – for building and training the neural network
- **scikit-learn** – for preprocessing (e.g., scaling)
- **Matplotlib** – for training visualization
- **Apache Airflow** (planned) – for scheduling and automation

## ETL Workflow

### 1. Extract
- A random sample of 2 million rows is drawn from `raw.ratings`.
- This sample is moved to `data_lake.ratings` and deleted from the raw schema to prevent data leakage.

### 2. Transform
- User profiles are computed as average ratings per genre.
- Movie features include genres, release year, average rating, and number of ratings.
- All numeric features are normalized using `StandardScaler`.
- The processed data is saved to `data_storage.ratings`.

### 3. Load / Train
- A two-tower neural network is built using Keras.
- The user and movie towers are trained in parallel to produce embeddings.
- Their dot product represents the predicted rating.
- The model is trained with early stopping on validation loss.

### 4. Predict
- A separate set of user-movie pairs is prepared for inference.
- Predictions are generated using the trained model.
- Results are stored in `predictions.ratings` for consumption by downstream systems or UIs.

## Automation Plan

To make this pipeline fully production-ready, Apache Airflow will be used to orchestrate tasks:

- **Daily**
  - Extract 50,000 new ratings from `raw.ratings`
  - Transform and scale features
  - Predict ratings using the current model
  - Store predictions in `predictions.ratings`

- **Weekly**
  - Retrain the model with updated data
  - Replace the production model

This approach ensures a continuously adapting system that stays aligned with user behavior over time.
